@model EventListener.Models.Activity

@{
    ViewData["Title"] = "Chat Room";
    var roomId = @ViewData["RoomId"];
    var currentUser = User.Identity.Name;
}


<link rel="stylesheet" href="~/css/ChatRoom/Room.css" asp-append-version="true">


<nav>
    <span class="span-left"><a href=""><i class="fa-solid fa-arrow-left"></i>&nbsp&nbsp‡∏Å‡∏•‡∏±‡∏ö</a></span>
    <div class="room-info">
        <h1 class="title">@Model.ActivityName</h1>
        <div class="username"><i class="fa-solid fa-circle" style="color: #63E6BE;"></i><h2>@currentUser</h2></div>
    </div>
    <span class="span-right"></span>
</nav>

<div id="chat-box" style="border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: scroll;">
    <ul id="messages-box">
        @foreach (var message in Model.ChatMessages)
        {
            <li><strong>@message.SenderId</strong>: @message.Message</li>
        }
    </ul>
</div>

<input type="text" id="messageInput" placeholder="Type a message..." />
<button onclick="sendMessage()">Send</button>

<script>
    const roomId = "@roomId";
    const userId = "@currentUser";
    const socket = new WebSocket(`ws://localhost:5198/ws/chat/${roomId}/${userId}`);
    const messageBox = document.getElementById("messages-box");

    socket.onopen = function(event) {
        console.log("WebSocket connected to room:", roomId);
    };

    socket.onmessage = function(event) {
        const message = event.data;
        console.log("Received message:", message);
        const li = document.createElement("li");
        li.innerHTML = event.data;
        messageBox.appendChild(li);

    };

    socket.onclose = function(event) {
        console.log("WebSocket connection closed");
    };

    socket.onerror = function(error) {
        console.error("WebSocket Error:", error);
    };

    function sendMessage() {
        const messageInput = document.getElementById("messageInput");
        const message = messageInput.value.trim();
        if (message && socket.readyState === WebSocket.OPEN) {
            socket.send(message);
            console.log("üì§ Sent:", message);
            messageInput.value = "";
        } else {
            console.error("WebSocket is not open or message is empty.");
        }
    }

</script>
