@model List<NotificationViewModel>
<link rel="stylesheet" href="~/css/noti/noti.css" asp-append-version="true">
<link rel="stylesheet" href="~/css/noti/not.css" asp-append-version="true">


<div class="container">
    <nav>
        <a asp-controller="Home" asp-action="Index" style="text-decoration: none; color: inherit;">
            <div class="logo">
                <i class="fa-solid fa-ear-listen fa-4x"></i>
                <span>EventListener</span>
            </div>
        </a>
        <div class="buttongroup-and-user">
            @if (User.Identity.IsAuthenticated)
            {
                <a asp-controller="activity" asp-action="create">
                    <button class="create-activity-btn">
                        <i class="fa-solid fa-plus"></i>
                        ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
                    </button>
                </a>
                <button class="noti-btn">
                    <i class="fa-regular fa-bell"></i>
                    ‡∏Å‡∏≤‡∏£‡πÄ‡πÄ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                </button>
<div class="user-dropdown">
                    <button class="user-avatar-btn" onclick="drop()">
                        @if (ViewBag.UserImageUrl == null)
                        {
                            <img src="~/user.png" alt="" class="avatar-img">
                        }
                        else
                        {
                            <img src="@ViewBag.UserImageUrl" alt="" class="avatar-img">
                        }
                    </button>
                    <div id="dropdown-content" class="dropdown-content">
                        <a asp-controller="profile" asp-action="index">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</a>
                        <a asp-controller="account" asp-action="logout">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a>
                    </div>
                </div>
            }
            else
            {
                <a asp-controller="account" asp-action="login">
                    <button class="login-btn">
                        Login
                    </button>
                </a>
                <a asp-controller="account" asp-action="register">
                    <button class="register-btn">
                        Register
                    </button>
                </a>
            }
        </div>
    </nav>
    <h2>‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>

    @if (Model.Count != 0)
    {
        @foreach (var notification in Model)
        {
            <div class="noti-container">
                <a href="/activity/detail/@notification.ActivityIdEncode" class="notification">
                    <span class="icon">üîî</span>
                    <div class="content">
                        <strong>@notification.ActivityName</strong>
                        <p>@notification.Message</p>
                    </div>
                </a>
                <button onclick="deleteNoti(@notification.Id, this)" class="delete"><i class="fa-solid fa-trash fa-xl" style="color: #ff0000;"></i></button>
            </div>

        }
    }
    else
    {
        <div class="notification-container">
            <div class="bell-icon">
                <img src="https://cdn-icons-png.flaticon.com/512/1827/1827349.png" alt="Notification Bell">
            </div>
            <p class="no-notifications" style="margin-top: 16px;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</p>
            <p class="notification-text" style="margin-top: 12px;">‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏à‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
        </div>
    }
</div>

<script src="~/js/activity/user_dropdown.js" asp-append-version="true"></script>
<script>
    async function deleteNoti(notiId, element) {
        try {
            let response = await fetch(`/Notification/DeleteNotification?notificationId=${notiId}`, {
                method: 'DELETE'
            });

            if (response.ok) {
                element.closest(".noti-container").remove(); // ‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤
                window.location.reload();
            } else {
                alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏î‡πâ");
            }
        } catch (error) {
            console.error("Error deleting notification:", error);
            alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå");
        }
    }

</script>
